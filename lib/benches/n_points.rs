#[macro_use]
extern crate criterion;
extern crate pretty_assertions;
extern crate rand;

use core::time::Duration;
use criterion::Criterion;
use d3_delaunay_rs::delaunay::Delaunay;
use geo_types::Coord;

static POINTS: [Coord<f64>; 100] = [
    Coord {
        x: 73.31706607987172,
        y: 84.4815913363546,
    },
    Coord {
        x: 95.84090338836057,
        y: 64.74540979347591,
    },
    Coord {
        x: 41.05083495704061,
        y: 3.7151382486303,
    },
    Coord {
        x: 48.224110117640905,
        y: 38.50115753555892,
    },
    Coord {
        x: 31.223105219216112,
        y: 38.20870751195586,
    },
    Coord {
        x: 55.89917152554333,
        y: 22.92003534186768,
    },
    Coord {
        x: 97.4371731860511,
        y: 74.07288475473412,
    },
    Coord {
        x: 46.995260501928485,
        y: 55.06050832036144,
    },
    Coord {
        x: 80.30425966068978,
        y: 40.611311252494225,
    },
    Coord {
        x: 33.30884809661352,
        y: 95.04564914000791,
    },
    Coord {
        x: 76.0718546463516,
        y: 5.602407673741869,
    },
    Coord {
        x: 61.46393903431822,
        y: 18.964057296674362,
    },
    Coord {
        x: 87.30277580075723,
        y: 30.566316109077757,
    },
    Coord {
        x: 20.305034050426425,
        y: 28.016145642968077,
    },
    Coord {
        x: 36.97066858219835,
        y: 11.488513471593595,
    },
    Coord {
        x: 56.106360587412176,
        y: 16.36326535699628,
    },
    Coord {
        x: 16.06920542383889,
        y: 35.182702434479125,
    },
    Coord {
        x: 38.56656075258362,
        y: 93.49543743120776,
    },
    Coord {
        x: 21.537302669531616,
        y: 34.18098552358649,
    },
    Coord {
        x: 82.83192485947494,
        y: 47.9039023818665,
    },
    Coord {
        x: 17.089516105435777,
        y: 28.76638162593962,
    },
    Coord {
        x: 43.301467977029645,
        y: 58.22428348248033,
    },
    Coord {
        x: 29.334372613121523,
        y: 97.9357048592093,
    },
    Coord {
        x: 51.0235385625529,
        y: 43.6683533332142,
    },
    Coord {
        x: 66.06280222144188,
        y: 10.383360877694642,
    },
    Coord {
        x: 60.2117015800838,
        y: 82.44894955064993,
    },
    Coord {
        x: 29.277577710011133,
        y: 8.759489646477647,
    },
    Coord {
        x: 46.07150636064543,
        y: 87.60969761689137,
    },
    Coord {
        x: 93.46567352382118,
        y: 75.38356523587134,
    },
    Coord {
        x: 22.193837801994164,
        y: 16.698827384479525,
    },
    Coord {
        x: 25.97109541030602,
        y: 26.68031536019949,
    },
    Coord {
        x: 22.550149573697347,
        y: 58.90839338168182,
    },
    Coord {
        x: 86.5551404885658,
        y: 52.80232622549123,
    },
    Coord {
        x: 52.02553092835119,
        y: 86.57002185896795,
    },
    Coord {
        x: 38.28831839554739,
        y: 36.43870897919715,
    },
    Coord {
        x: 20.4761716932584,
        y: 92.72192907689228,
    },
    Coord {
        x: 91.91548998848397,
        y: 64.76229623722428,
    },
    Coord {
        x: 34.21995458746922,
        y: 74.77464017489797,
    },
    Coord {
        x: 17.56032378399305,
        y: 32.650956133466636,
    },
    Coord {
        x: 82.28116862214608,
        y: 79.59080321090713,
    },
    Coord {
        x: 85.24814179602623,
        y: 31.08139322302182,
    },
    Coord {
        x: 31.845968144094996,
        y: 19.293480975670224,
    },
    Coord {
        x: 18.549295385926595,
        y: 44.16980612650907,
    },
    Coord {
        x: 57.842465692102124,
        y: 70.29047148143127,
    },
    Coord {
        x: 75.23612965152925,
        y: 24.63534152502045,
    },
    Coord {
        x: 71.1127491750504,
        y: 2.7265912143704973,
    },
    Coord {
        x: 69.86032786588515,
        y: 81.25609963617899,
    },
    Coord {
        x: 26.621167377820694,
        y: 56.75041258112212,
    },
    Coord {
        x: 45.45401248965132,
        y: 68.37238944556077,
    },
    Coord {
        x: 56.88941091060066,
        y: 24.885075644464806,
    },
    Coord {
        x: 68.23849953489902,
        y: 80.82208327497656,
    },
    Coord {
        x: 6.47916078376943,
        y: 63.677862209401894,
    },
    Coord {
        x: 95.1790358646229,
        y: 25.18382238317807,
    },
    Coord {
        x: 6.953488093662319,
        y: 61.60396047626276,
    },
    Coord {
        x: 45.367314696353446,
        y: 35.766854583789964,
    },
    Coord {
        x: 84.16615712664166,
        y: 74.015463362046,
    },
    Coord {
        x: 92.86359029993673,
        y: 21.285241856133204,
    },
    Coord {
        x: 40.46358705723439,
        y: 3.442306568322433,
    },
    Coord {
        x: 77.82060649631173,
        y: 60.31508878825493,
    },
    Coord {
        x: 38.56496314185742,
        y: 31.064364287968758,
    },
    Coord {
        x: 67.7580828914383,
        y: 83.98283590326626,
    },
    Coord {
        x: 66.80425239893812,
        y: 81.18891416357576,
    },
    Coord {
        x: 47.029382967127795,
        y: 79.36537038317732,
    },
    Coord {
        x: 39.10713041695716,
        y: 67.60106210813966,
    },
    Coord {
        x: 8.820933932979784,
        y: 59.72488340723397,
    },
    Coord {
        x: 3.394131189571791,
        y: 75.32553319325137,
    },
    Coord {
        x: 31.486890526419668,
        y: 30.564147111139476,
    },
    Coord {
        x: 7.599708067540302,
        y: 16.390577336925254,
    },
    Coord {
        x: 76.42642509248287,
        y: 16.8518990879863,
    },
    Coord {
        x: 56.0457425768825,
        y: 65.25817971651453,
    },
    Coord {
        x: 76.44284950830092,
        y: 82.2250369983046,
    },
    Coord {
        x: 33.615646524661656,
        y: 82.14896590307478,
    },
    Coord {
        x: 49.91613337198673,
        y: 79.26301432192737,
    },
    Coord {
        x: 65.3533466646611,
        y: 74.12536310175685,
    },
    Coord {
        x: 3.194600632197087,
        y: 77.71152693777425,
    },
    Coord {
        x: 26.57883580945544,
        y: 41.82242807599886,
    },
    Coord {
        x: 50.922858956865674,
        y: 57.665096185045336,
    },
    Coord {
        x: 2.25443477873306,
        y: 10.822141424501194,
    },
    Coord {
        x: 24.92084304359549,
        y: 97.93206098508223,
    },
    Coord {
        x: 68.45929813959498,
        y: 92.3706409167191,
    },
    Coord {
        x: 76.88515711333558,
        y: 78.35600996311987,
    },
    Coord {
        x: 5.987008194051199,
        y: 56.227158350683766,
    },
    Coord {
        x: 13.824444423463298,
        y: 44.24002681502549,
    },
    Coord {
        x: 36.91971661554204,
        y: 39.45384135028181,
    },
    Coord {
        x: 63.22497829094384,
        y: 57.36494039422865,
    },
    Coord {
        x: 95.990919499077,
        y: 94.36453866847359,
    },
    Coord {
        x: 69.46567789293852,
        y: 7.140083214307641,
    },
    Coord {
        x: 14.205006418952756,
        y: 38.05540802237981,
    },
    Coord {
        x: 75.91299439121325,
        y: 11.429839528648575,
    },
    Coord {
        x: 53.489150335775136,
        y: 35.75553840112501,
    },
    Coord {
        x: 80.61210635786881,
        y: 57.57171377442677,
    },
    Coord {
        x: 71.32051574938606,
        y: 5.054719435617013,
    },
    Coord {
        x: 74.02759137836199,
        y: 67.33162453846067,
    },
    Coord {
        x: 97.16998765300993,
        y: 21.117210381058772,
    },
    Coord {
        x: 4.499621669308816,
        y: 84.18070605353792,
    },
    Coord {
        x: 2.00615295445764,
        y: 3.908202181520547,
    },
    Coord {
        x: 89.18820645077552,
        y: 97.80971997279102,
    },
    Coord {
        x: 34.67601432366078,
        y: 71.74015476922929,
    },
    Coord {
        x: 77.80245488184897,
        y: 68.97481888661304,
    },
    Coord {
        x: 44.216161261042046,
        y: 30.03654027439042,
    },
];

// Code used to generate static points.
// This code was run once to generate :-
//
// static Point: [Coord<f64>; 100]
fn output_points() {
    use rand::Rng;
    let mut rng = rand::thread_rng();

    let points = (0..100)
        .map(|_| Coord {
            x: 96_f64.mul_add(rng.gen::<f64>(), 2_f64),
            y: 96_f64.mul_add(rng.gen::<f64>(), 2_f64),
        })
        .collect::<Vec<_>>();

    for p in &points {
        println!("{:#?},", p);
    }
}

fn criterion_benchmark(c: &mut Criterion) {
    let mut g = c.benchmark_group("n points");

    // Increased the default run time by 3 seconds after gettings warnings that the task was taking too long.
    g.measurement_time(Duration::from_secs(11));

    g.bench_function("transforms", |b| {
        b.iter(|| {
            let delaunay = Delaunay::new(&POINTS);
            assert!(delaunay.delaunator.triangles.len() > 500);
            let voronoi =
                delaunay.voronoi(Some((0_f64, 0_f64, 100_f64, 100_f64)));

            assert!(voronoi.circumcenters.len() > 50);
        })
    });
}

criterion_group!(benches, criterion_benchmark);
criterion_main!(benches);
